import java.util.*;

public class Main {
    static class Process {
        String pid;
        int arrival, burst, remaining, completion, waiting, turnaround;
        int startTime = -1;

        Process(String pid, int arrival, int burst) {
            this.pid = pid;
            this.arrival = arrival;
            this.burst = burst;
            this.remaining = burst;
        }
    }

    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        System.out.print("Enter Time Quantum: ");
        int tq = sc.nextInt();

        System.out.print("Enter number of processes: ");
        int n = sc.nextInt();

        List<Process> processes = new ArrayList<>();
        for (int i = 0; i < n; i++) {
            System.out.print("Enter Process ID, Arrival Time, Burst Time: ");
            String pid = sc.next();
            int arrival = sc.nextInt();
            int burst = sc.nextInt();
            processes.add(new Process(pid, arrival, burst));
        }

        // Sort processes by arrival time
        processes.sort(Comparator.comparingInt(p -> p.arrival));

        Queue<Process> readyQueue = new LinkedList<>();
        List<String> gantt = new ArrayList<>();

        int time = 0, completed = 0;
        double totalWT = 0, totalTAT = 0;

        while (completed < n) {
            // Add all processes that have arrived to the queue
            for (Process p : processes) {
                if (p.arrival == time) {
                    readyQueue.add(p);
                }
            }

            if (readyQueue.isEmpty()) {
                gantt.add("Idle");
                time++;
                continue;
            }

            Process current = readyQueue.poll();

            if (current.startTime == -1)
                current.startTime = time;

            int execTime = Math.min(tq, current.remaining);
            current.remaining -= execTime;
            for (int i = 0; i < execTime; i++) {
                gantt.add(current.pid);
                time++;

                // Add newly arrived processes during execution
                for (Process p : processes) {
                    if (p.arrival == time) {
                        readyQueue.add(p);
                    }
                }
            }

            if (current.remaining > 0) {
                readyQueue.add(current);
            } else {
                current.completion = time;
                current.turnaround = current.completion - current.arrival;
                current.waiting = current.turnaround - current.burst;
                totalWT += current.waiting;
                totalTAT += current.turnaround;
                completed++;
            }
        }

        // Display results
        System.out.println("\nPID\tArrival\tBurst\tCompletion\tTurnaround\tWaiting");
        for (Process p : processes) {
            System.out.printf("%s\t%d\t%d\t%d\t\t%d\t\t%d%n",
                    p.pid, p.arrival, p.burst, p.completion, p.turnaround, p.waiting);
        }

        System.out.printf("%nAverage Turnaround Time: %.2f%n", totalTAT / n);
        System.out.printf("Average Waiting Time: %.2f%n", totalWT / n);

        // Gantt Chart
        System.out.println("\nGantt Chart:");
        System.out.print("0");
        for (int i = 0; i < gantt.size(); i++) {
            System.out.print(" | " + gantt.get(i));
        }
        System.out.println(" | " + time);
    }
}
